# CS2-YCY-Link æ‰‹åŠ¨æ‰“åŒ…æŒ‡å—

å¦‚æœè‡ªåŠ¨æ‰“åŒ…è„šæœ¬å‡ºç°é—®é¢˜ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ‰‹åŠ¨æ‰“åŒ…ã€‚

## ğŸ“‹ å‰ç½®å‡†å¤‡

### 1. å®‰è£…æ‰“åŒ…å·¥å…·

```bash
# å®‰è£… PyInstaller
pip install pyinstaller

# å®‰è£… pkg
npm install -g pkg
```

### 2. éªŒè¯å·¥å…·å®‰è£…

```bash
# æ£€æŸ¥ PyInstaller
python -m PyInstaller --version

# æ£€æŸ¥ pkg
pkg --version
```

---

## ğŸ”¨ åˆ†æ­¥æ‰“åŒ…

### æ­¥éª¤ 1: é…ç½®ç¯å¢ƒå˜é‡å¹¶æ„å»ºå‰ç«¯

#### 1.1 é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡

åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶ `.env.production`ï¼š

```bash
cd frontend
```

åˆ›å»ºæ–‡ä»¶ `.env.production`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```env
# ç”Ÿäº§ç¯å¢ƒé…ç½®
# WebSocket è¿æ¥åŸºç¡€åœ°å€ï¼ˆåç«¯æœåŠ¡åœ°å€ï¼‰
VITE_WS_BASE_URL=ws://127.0.0.1:8001
```

**è¯´æ˜**ï¼š
- æ­¤é…ç½®ç¡®ä¿æ‰“åŒ…åå‰ç«¯èƒ½æ­£ç¡®è¿æ¥åç«¯çš„ WebSocket æœåŠ¡
- é»˜è®¤ä½¿ç”¨ `ws://127.0.0.1:8001`ï¼Œå¦‚æœåç«¯åœ°å€ä¸åŒè¯·ä¿®æ”¹
- å¼€å‘ç¯å¢ƒä½¿ç”¨ `vite.config.js` ä¸­çš„ä»£ç†é…ç½®ï¼Œæ— éœ€æ­¤æ–‡ä»¶

#### 1.2 æ„å»ºå‰ç«¯

```bash
npm run build
cd ..
```

**é¢„æœŸç»“æœ**: `frontend/dist/` ç›®å½•åŒ…å«æ„å»ºåçš„æ–‡ä»¶

**éªŒè¯æ„å»ºç»“æœ**ï¼š
```bash
# æ£€æŸ¥æ˜¯å¦åŒ…å«ç¯å¢ƒå˜é‡é…ç½®
findstr /s "VITE_WS_BASE_URL" frontend\dist\assets\*.js
```

---

### æ­¥éª¤ 2: æ‰“åŒ… Python åç«¯

```bash
cd backend
python -m PyInstaller build.spec
cd ..
```

**é¢„æœŸç»“æœ**: `backend/dist/backend.exe` æ–‡ä»¶ç”Ÿæˆ

**å¸¸è§é—®é¢˜**:
- å¦‚æœæç¤ºæ‰¾ä¸åˆ°æ¨¡å—ï¼Œåœ¨ `build.spec` çš„ `hiddenimports` ä¸­æ·»åŠ 
- å¦‚æœæ‰“åŒ…å¤±è´¥ï¼Œå°è¯•: `python -m PyInstaller --onefile main_server.py`

---

### æ­¥éª¤ 3: æ‰“åŒ… Node.js IM æœåŠ¡

```bash
cd im-service
npm run build
cd ..
```

**é¢„æœŸç»“æœ**: `im-service/dist/im-service.exe` æ–‡ä»¶ç”Ÿæˆ

**å¸¸è§é—®é¢˜**:
- å¦‚æœ pkg æœªå®‰è£…ï¼Œè¿è¡Œ: `npm install -g pkg`
- å¦‚æœæ‰“åŒ…å¤±è´¥ï¼Œå°è¯•: `pkg server.js --target node18-win-x64 --output dist/im-service.exe`

---

### æ­¥éª¤ 4: æ‰“åŒ…å¯åŠ¨å™¨

```bash
python -m PyInstaller --onefile --console --name "CS2-YCY-Link" launcher-protable.py
```

**é¢„æœŸç»“æœ**: `dist/CS2-YCY-Link.exe` æ–‡ä»¶ç”Ÿæˆ

---

### æ­¥éª¤ 5: ç»„ç»‡å‘å¸ƒæ–‡ä»¶

#### 5.1 åˆ›å»ºå‘å¸ƒç›®å½•

```bash
mkdir release
mkdir release\frontend
```

#### 5.2 å¤åˆ¶å¯æ‰§è¡Œæ–‡ä»¶

```bash
copy dist\CS2-YCY-Link.exe release\
copy backend\dist\backend.exe release\
copy im-service\dist\im-service.exe release\
```

#### 5.3 å¤åˆ¶å‰ç«¯æ–‡ä»¶

```bash
xcopy /E /I /Y frontend\dist release\frontend
```

#### 5.4 åˆ›å»ºä½¿ç”¨è¯´æ˜

åœ¨ `release\` ç›®å½•åˆ›å»º `README.txt`:

```
CS2-YCY-Link ä½¿ç”¨è¯´æ˜
====================

1. é¦–æ¬¡ä½¿ç”¨é…ç½®
   - å°† state.json.example é‡å‘½åä¸º state.json
   - ç¼–è¾‘ state.jsonï¼Œå¡«å…¥ä½ çš„ UID å’Œ Token

2. å¯åŠ¨ç¨‹åº
   - åŒå‡» CS2-YCY-Link.exe
   - ç­‰å¾…æµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€

3. é…ç½® CS2 GSI
   - åœ¨ CS2 æ¸¸æˆç›®å½•åˆ›å»ºé…ç½®æ–‡ä»¶
   - è·¯å¾„: Steam\steamapps\common\Counter-Strike Global Offensive\game\csgo\cfg\
   - æ–‡ä»¶å: gamestate_integration_ycy.cfg

4. å¼€å§‹æ¸¸æˆ
   - å¯åŠ¨ CS2 æ¸¸æˆ
   - ç³»ç»Ÿä¼šè‡ªåŠ¨ç›‘å¬æ¸¸æˆäº‹ä»¶

5. åœæ­¢ç¨‹åº
   - åœ¨å¯åŠ¨å™¨çª—å£æŒ‰ Ctrl+C
   - æˆ–ç›´æ¥å…³é—­æ‰€æœ‰çª—å£
```

---

## ğŸ“¦ æœ€ç»ˆæ–‡ä»¶ç»“æ„

```
release/
â”œâ”€â”€ CS2-YCY-Link.exe          # å¯åŠ¨å™¨
â”œâ”€â”€ backend.exe                # åç«¯æœåŠ¡
â”œâ”€â”€ im-service.exe             # IM æœåŠ¡
â”œâ”€â”€ frontend/                  # å‰ç«¯é™æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ assets/
â”‚       â”œâ”€â”€ index-xxx.js
â”‚       â””â”€â”€ index-xxx.css
â”œâ”€â”€ state.json.example         # é…ç½®æ¨¡æ¿
â””â”€â”€ README.txt                 # ä½¿ç”¨è¯´æ˜
```

---

## ğŸ§ª æµ‹è¯•æ‰“åŒ…ç»“æœ

### 1. æµ‹è¯•å¯åŠ¨å™¨

```bash
cd release
CS2-YCY-Link.exe
```

åº”è¯¥çœ‹åˆ°ï¼š
- IM æœåŠ¡çª—å£æ‰“å¼€
- åç«¯æœåŠ¡çª—å£æ‰“å¼€
- æµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€æ§åˆ¶é¢æ¿

### 2. æµ‹è¯•åŠŸèƒ½

1. åœ¨æ§åˆ¶é¢æ¿é…ç½® UID å’Œ Token
2. æ£€æŸ¥ IM è¿æ¥çŠ¶æ€
3. æµ‹è¯•å‘é€æŒ‡ä»¤

---

## â“ å¸¸è§é—®é¢˜

### Q: PyInstaller æ‰“åŒ…å¤±è´¥

**A:** å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š

1. æ¸…ç†ç¼“å­˜
```bash
python -m PyInstaller --clean build.spec
```

2. ä½¿ç”¨ç®€å•æ¨¡å¼
```bash
cd backend
python -m PyInstaller --onefile --console main_server.py
```

3. æ£€æŸ¥ä¾èµ–
```bash
pip list
```

### Q: pkg æ‰“åŒ…å¤±è´¥

**A:** å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š

1. æ›´æ–° pkg
```bash
npm install -g pkg@latest
```

2. æŒ‡å®š Node ç‰ˆæœ¬
```bash
pkg server.js --target node18-win-x64
```

3. æ£€æŸ¥ package.json
ç¡®ä¿ `"type": "module"` å­˜åœ¨

### Q: å¯åŠ¨å™¨æ— æ³•æ‰¾åˆ°æ–‡ä»¶

**A:** æ£€æŸ¥æ–‡ä»¶è·¯å¾„ï¼š

1. ç¡®ä¿æ‰€æœ‰ exe æ–‡ä»¶åœ¨åŒä¸€ç›®å½•
2. ç¡®ä¿ frontend æ–‡ä»¶å¤¹å­˜åœ¨
3. ç¡®ä¿ state.json æˆ– state.json.example å­˜åœ¨

### Q: å‰ç«¯é¡µé¢æ— æ³•åŠ è½½

**A:** æ£€æŸ¥åç«¯é…ç½®ï¼š

1. ç¡®è®¤ `backend/app.py` ä¸­æœ‰é™æ€æ–‡ä»¶æŒ‚è½½ä»£ç 
2. ç¡®è®¤ frontend æ–‡ä»¶å¤¹è·¯å¾„æ­£ç¡®
3. è®¿é—® `http://localhost:8001` æŸ¥çœ‹æ˜¯å¦èƒ½åŠ è½½

### Q: æ‰“åŒ…å WebSocket è¿æ¥å¤±è´¥

**A:** è¿™æ˜¯æ‰“åŒ…åçš„å¸¸è§é—®é¢˜ï¼Œå·²åœ¨ v1.0.1 ä¸­ä¿®å¤ï¼š

1. **ç¡®è®¤ç¯å¢ƒå˜é‡é…ç½®**ï¼šæ£€æŸ¥ `frontend/.env.production` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. **æ£€æŸ¥é…ç½®å†…å®¹**ï¼šç¡®ä¿åŒ…å« `VITE_WS_BASE_URL=ws://127.0.0.1:8001`
3. **é‡æ–°æ„å»ºå‰ç«¯**ï¼š
   ```bash
   cd frontend
   npm run build
   ```
4. **éªŒè¯æ„å»ºäº§ç‰©**ï¼šæ£€æŸ¥ç”Ÿæˆçš„ JS æ–‡ä»¶ä¸­æ˜¯å¦åŒ…å«æ­£ç¡®çš„ WebSocket URL
5. **å¤åˆ¶åˆ°åç«¯**ï¼šç¡®ä¿å‰ç«¯æ–‡ä»¶å·²æ­£ç¡®å¤åˆ¶åˆ°åç«¯é™æ€æ–‡ä»¶ç›®å½•

**é¢„é˜²æªæ–½**ï¼š
- åœ¨æ„å»ºå‰åŠ¡å¿…åˆ›å»º `.env.production` æ–‡ä»¶
- ä½¿ç”¨è‡ªåŠ¨åŒ–æ‰“åŒ…è„šæœ¬ `build.bat` å¯é¿å…æ­¤é—®é¢˜

### Q: å‰ç«¯æç¤º "WebSocket connection failed"

**A:** æ’æŸ¥æ­¥éª¤ï¼š

1. **æ£€æŸ¥åç«¯æœåŠ¡**ï¼šç¡®è®¤åç«¯è¿è¡Œåœ¨ç«¯å£ 8001
2. **æ£€æŸ¥ WebSocket ç«¯ç‚¹**ï¼šè®¿é—® `http://localhost:8001/ws/game-state` æµ‹è¯•
3. **æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°**ï¼šæŸ¥çœ‹ Network â†’ WS æ ‡ç­¾é¡µçš„è¯¦ç»†é”™è¯¯
4. **æ£€æŸ¥ç¯å¢ƒå˜é‡**ï¼šç¡®è®¤ `.env.production` é…ç½®æ­£ç¡®
5. **æ£€æŸ¥é˜²ç«å¢™**ï¼šç¡®ä¿ç«¯å£ 8001 æœªè¢«é˜»æ­¢

### Q: æ‰“åŒ…åä½“ç§¯å¤ªå¤§

**A:** ä¼˜åŒ–æ–¹æ³•ï¼š

1. ä½¿ç”¨ UPX å‹ç¼©
```bash
upx --best backend.exe
upx --best im-service.exe
```

2. æ’é™¤ä¸å¿…è¦çš„ä¾èµ–
åœ¨ `build.spec` ä¸­æ·»åŠ  `excludes`

3. ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
åªå®‰è£…å¿…è¦çš„åŒ…åå†æ‰“åŒ…

---

## ğŸ¯ å¿«é€Ÿå‘½ä»¤æ±‡æ€»

```bash
# å®Œæ•´æ‰“åŒ…æµç¨‹ï¼ˆå¤åˆ¶ç²˜è´´æ‰§è¡Œï¼‰

# 1. æ„å»ºå‰ç«¯
cd frontend && npm run build && cd ..

# 2. æ‰“åŒ…åç«¯
cd backend && python -m PyInstaller build.spec && cd ..

# 3. æ‰“åŒ… IM æœåŠ¡
cd im-service && npm run build && cd ..

# 4. æ‰“åŒ…å¯åŠ¨å™¨
python -m PyInstaller --onefile --console --name "CS2-YCY-Link" launcher-portable.py

# 5. ç»„ç»‡æ–‡ä»¶
mkdir release
mkdir release\frontend
copy dist\CS2-YCY-Link.exe release\
copy backend\dist\backend.exe release\
copy im-service\dist\im-service.exe release\
xcopy /E /I /Y frontend\dist release\frontend

# å®Œæˆï¼
echo æ‰“åŒ…å®Œæˆï¼Œæ–‡ä»¶åœ¨ release ç›®å½•
```

---

## ğŸ“ æ‰“åŒ…æ£€æŸ¥æ¸…å•

æ‰“åŒ…å®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] `CS2-YCY-Link.exe` å­˜åœ¨ä¸”å¯è¿è¡Œ
- [ ] `backend.exe` å­˜åœ¨
- [ ] `im-service.exe` å­˜åœ¨
- [ ] `frontend/` ç›®å½•å­˜åœ¨ä¸”åŒ…å« `index.html`
- [ ] `frontend/assets/` ç›®å½•å­˜åœ¨ä¸”åŒ…å« JS/CSS æ–‡ä»¶
- [ ] `state.json.example` å­˜åœ¨
- [ ] `README.txt` å­˜åœ¨
- [ ] å¯åŠ¨å™¨èƒ½æ­£å¸¸å¯åŠ¨æ‰€æœ‰æœåŠ¡
- [ ] æµè§ˆå™¨èƒ½æ‰“å¼€æ§åˆ¶é¢æ¿
- [ ] IM è¿æ¥åŠŸèƒ½æ­£å¸¸
- [ ] äº‹ä»¶é…ç½®åŠŸèƒ½æ­£å¸¸

---

**ç¥æ‰“åŒ…é¡ºåˆ©ï¼** ğŸ‰
